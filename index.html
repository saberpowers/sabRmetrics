<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Query {statsapi,baseballsavant}.mlb.com and fit fundamental sabermetric models • sabRmetrics</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Query {statsapi,baseballsavant}.mlb.com and fit fundamental sabermetric models">
<meta name="description" content="The highest-fidelity raw MLB data are available from statsapi.mlb.com and baseballsavant.mlb.com, and some minor league data are available from these APIs as well. This package provides functions to query those APIs, returning the data in a collection of well-factored tables (as opposed to returning a single table). Additionally, this package offers functions to estimate base-out run expectancy; estimate count values; and recover the full estimated quadratic trajectory of a pitch from pitch tracking data.">
<meta property="og:description" content="The highest-fidelity raw MLB data are available from statsapi.mlb.com and baseballsavant.mlb.com, and some minor league data are available from these APIs as well. This package provides functions to query those APIs, returning the data in a collection of well-factored tables (as opposed to returning a single table). Additionally, this package offers functions to estimate base-out run expectancy; estimate count values; and recover the full estimated quadratic trajectory of a pitch from pitch tracking data.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">sabRmetrics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/saberpowers/sabRmetrics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="sabrmetrics">sabRmetrics<a class="anchor" aria-label="anchor" href="#sabrmetrics"></a>
</h1></div>
<p><a href="https://github.com/saberpowers/sabRmetrics/actions" class="external-link"><img src="https://github.com/saberpowers/sabRmetrics/workflows/R-CMD-check/badge.svg" target="_blank" alt="R build status"></a></p>
<p>The highest-fidelity raw MLB data are available from statsapi.mlb.com and baseballsavant.mlb.com, and some minor league data are available from these APIs as well. This package provides functions to query those APIs, returning the data in a collection of well-factored tables (as opposed to returning a single table). Additionally, this package offers functions to estimate base-out run expectancy; estimate count values; and recover the full estimated quadratic trajectory of a pitch from pitch tracking data.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span>repo <span class="op">=</span> <span class="st">"saberpowers/sabRmetrics"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="downloading-data">Downloading data<a class="anchor" aria-label="anchor" href="#downloading-data"></a>
</h2>
<p>Most important data are available from statsapi.mlb.com. The function below returns four tables: game, event, pitch and play. - The <em>game</em> table holds game-level information, such as teams, venue and date. - The <em>event</em> table holds plate-appearance-level information, such as base-out state, players and outcome. - The <em>pitch</em> table holds pitch-level information, such as pitch outcomes, pitch tracking and batted ball tracking. - The <em>play</em> table is similar to the pitch table except that it also includes data regarding pre-/post-base-out-state, including pickoff attempts and stolen base attempts (no tracking data).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Typically takes about 5 seconds for a single game</span></span>
<span><span class="va">data_statsapi</span> <span class="op">&lt;-</span> <span class="fu">sabRmetrics</span><span class="fu">::</span><span class="fu"><a href="reference/download_statsapi.html">download_statsapi</a></span><span class="op">(</span></span>
<span>  start_date <span class="op">=</span> <span class="st">"2024-07-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2024-07-01"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># You can also run this function with parallel computation if you want to download more games</span></span>
<span><span class="co">#cluster &lt;- parallel::makeCluster(parallel::detectCores())</span></span>
<span><span class="co">#data_statsapi &lt;- sabRmetrics::download_statsapi(</span></span>
<span><span class="co">#  start_date = "2024-01-01",</span></span>
<span><span class="co">#  end_date = "2024-12-31",</span></span>
<span><span class="co">#  cl = cluster</span></span>
<span><span class="co">#)</span></span>
<span><span class="co">#parallel::stopCluster(cluster)</span></span></code></pre></div>
<p>Some unique Statcast data are not available from statsapi.mlb.com, such as pitch spin and swing tracking. For these data, we turn to baseballsavant.mlb.com. The function below returns pitch-level data that can be joined with the pitch table from statsapi.mlb.com using columns <code>game_id</code>, <code>year</code>, <code>event_index</code> and <code>pitch_number</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Typically takes about 30 seconds for the first query of a single game but drastically speeds</span></span>
<span><span class="co"># up for subsequent queries of the same game because the API caches the results of the query</span></span>
<span><span class="va">data_baseballsavant</span> <span class="op">&lt;-</span> <span class="fu">sabRmetrics</span><span class="fu">::</span><span class="fu"><a href="reference/download_baseballsavant.html">download_baseballsavant</a></span><span class="op">(</span></span>
<span>  start_date <span class="op">=</span> <span class="st">"2024-07-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2024-07-01"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># You can also run this function with parallel computation if you want to download more games</span></span>
<span><span class="co">#cluster &lt;- parallel::makeCluster(parallel::detectCores())</span></span>
<span><span class="co">#data_statsapi &lt;- sabRmetrics::download_baseballsavant(</span></span>
<span><span class="co">#  start_date = "2024-01-01",</span></span>
<span><span class="co">#  end_date = "2024-12-31",</span></span>
<span><span class="co">#  cl = cluster</span></span>
<span><span class="co">#)</span></span>
<span><span class="co">#parallel::stopCluster(cluster)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fitting-fundamental-models">Fitting fundamental models<a class="anchor" aria-label="anchor" href="#fitting-fundamental-models"></a>
</h2>
<p>Possibly the most fundamental model in sabermetrics is base-out run expectancy. The function below fits a Markov model assuming the state is specified by the bases occupied and the number of outs, using the empirical transition probabilities between states.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># You probably want at least one full season of data for this, maybe as many as three seasons</span></span>
<span><span class="va">base_out_run_exp</span> <span class="op">&lt;-</span> <span class="fu">sabRmetrics</span><span class="fu">::</span><span class="fu"><a href="reference/estimate_base_out_run_exp.html">estimate_base_out_run_exp</a></span><span class="op">(</span>event <span class="op">=</span> <span class="va">data_statsapi</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span></code></pre></div>
<p>A refinement on base-out run expectancy would be to include the ball-strike count in the state. Rather than expanding the Markov state to include count, the function below calculates the expected change in base-out run expectancy result from a plate appearance, conditional on the plate appearance passing through the specified count. We interpret this as the run value of the count, which allows us to measure the outcomes of individual pitches on the run scale.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># You probably want at least one full season of data for this, maybe as many as three seasons</span></span>
<span><span class="va">count_value</span> <span class="op">&lt;-</span> <span class="fu">sabRmetrics</span><span class="fu">::</span><span class="fu"><a href="reference/estimate_count_value.html">estimate_count_value</a></span><span class="op">(</span></span>
<span>  play <span class="op">=</span> <span class="va">data_datsapi</span><span class="op">$</span><span class="va">play</span>,</span>
<span>  event <span class="op">=</span> <span class="va">data_stastapi</span><span class="op">$</span><span class="va">event</span>,</span>
<span>  base_out_run_exp <span class="op">=</span> <span class="va">base_out_run_exp</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Lastly, if you are working with pitch tracking data, a fundamentally useful step is to recreate the full estimated quadratic trajectory of the pitch. The vast majority of well-known pitch tracking metrics (e.g. horizontal/vertical break, plate location, approach angle) are derived from this estimated quadratic trajectory. The function <code>get_quadratic_coef</code> below calculates the coefficients required to reproduce the full trajectory from the data provided by either statsapi.mlb.com or baseballsavant.mlb.com. The function <code>get_trackman_metrics</code> below shows how to derive many well-known pitch tracking metrics from the quadratic coefficients.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pitch_statsapi</span> <span class="op">&lt;-</span> <span class="va">data_statsapi</span><span class="op">$</span><span class="va">pitch</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sabRmetrics</span><span class="fu">::</span><span class="fu"><a href="reference/get_quadratic_coef.html">get_quadratic_coef</a></span><span class="op">(</span>source <span class="op">=</span> <span class="st">"statsapi"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sabRmetrics</span><span class="fu">::</span><span class="fu"><a href="reference/get_trackman_metrics.html">get_trackman_metrics</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pitch_baseballsavant</span> <span class="op">&lt;-</span> <span class="va">data_baseballsavant</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sabRmetrics</span><span class="fu">::</span><span class="fu"><a href="reference/get_quadratic_coef.html">get_quadratic_coef</a></span><span class="op">(</span>source <span class="op">=</span> <span class="st">"baseballsavant"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sabRmetrics</span><span class="fu">::</span><span class="fu"><a href="reference/get_trackman_metrics.html">get_trackman_metrics</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/saberpowers/sabRmetrics/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/saberpowers/sabRmetrics/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing sabRmetrics</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://saberpowers.github.io/" class="external-link">Scott Powers</a> <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://saberpowers.github.io/" class="external-link">Scott Powers</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
